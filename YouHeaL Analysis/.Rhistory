legend.text = element_text(size = 10),
legend.direction = "horizontal",
legend.title = element_blank(),
legend.key.size = unit(0.7, "lines"),
axis.title.x = element_blank(),
axis.text.x = element_text(angle = 40, hjust = 1, size = 10)
)
}
p_bes_vsqol_oag <- data_bes %>% plot_bes()
p_bes_vsqol_oag
dev.copy(png, "bes_vsqol.png", width = 2400, height = 1200, res = 300)
p_bes_vsqol_oag
dev.off()
# import data
data_bes_raw <- read_xlsx("Barbados Eye Study.xlsx", sheet = "Data")
# format data
data_bes <- data_bes_raw %>%
# remove row indicating n
dplyr::filter(vsqol != "n") %>%
mutate(
# add a value for indicating significance
p_0.05 = p_0.05*95 + 5,
# make a mean difference column
mean_diff = none - oag,
# add a value for indicating clinically meaningful difference
clinic_diff = ifelse(mean_diff >=5, 100, NA),
# make a max diff value for CTT so it's at the top
mean_diff = ifelse(vsqol == "*Composite score", yes = 100, no = mean_diff)
) %>%
# make to long format
gather(key = disease, value = mean, -vsqol, -p_0.05, -none_se, -oag_se, -mean_diff, -clinic_diff)
plot_bes <- function(data){
data %>%
ggplot(aes(x = reorder(vsqol, -mean_diff), fill = disease)) +
# geom_point(aes(y = clinic_diff), shape = 19, color = "blue", size = 4, alpha = 0.2) +
geom_point(aes(y = p_0.05), shape = 8, color = "red", size = 1, alpha = 0.8) +
geom_bar(aes(y = mean), stat = "identity", position = "dodge") +
scale_fill_manual(values = c("none" = "#FFC726", "oag" = "#00267F"), labels = c("None", "Open Angle Glaucoma")) +
ggtitle("Barbados Eye Study") +
ylab("VSQOL") +
annotate("text", x = 1, y = 93, label = "p < 0.05", size = 3) +
theme(
plot.title = element_text(size = 20),
legend.position = c(0.64, 1.07),
legend.text = element_text(size = 10),
legend.direction = "horizontal",
legend.title = element_blank(),
legend.key.size = unit(0.7, "lines"),
axis.title.x = element_blank(),
axis.text.x = element_text(angle = 40, hjust = 1, size = 10)
)
}
p_bes_vsqol_oag <- data_bes %>% plot_bes()
p_bes_vsqol_oag
dev.copy(png, "bes_vsqol.png", width = 2400, height = 1200, res = 300)
p_bes_vsqol_oag
dev.off()
# import data
data_bes_raw <- read_xlsx("Barbados Eye Study.xlsx", sheet = "Data")
# format data
data_bes <- data_bes_raw %>%
# remove row indicating n
dplyr::filter(vsqol != "n") %>%
mutate(
# add a value for indicating significance
p_0.05 = p_0.05*95 + 5,
# make a mean difference column
mean_diff = none - oag,
# add a value for indicating clinically meaningful difference
clinic_diff = ifelse(mean_diff >=5, 100, NA),
# make a max diff value for CTT so it's at the top
mean_diff = ifelse(vsqol == "*Composite score", yes = 100, no = mean_diff)
) %>%
# make to long format
gather(key = disease, value = mean, -vsqol, -p_0.05, -none_se, -oag_se, -mean_diff, -clinic_diff)
plot_bes <- function(data){
data %>%
ggplot(aes(x = reorder(vsqol, -mean_diff), fill = disease)) +
# geom_point(aes(y = clinic_diff), shape = 19, color = "blue", size = 4, alpha = 0.2) +
geom_point(aes(y = p_0.05), shape = 8, color = "red", size = 1, alpha = 0.8) +
geom_bar(aes(y = mean), stat = "identity", position = "dodge") +
scale_fill_manual(values = c("none" = "#FFC726", "oag" = "#00267F"), labels = c("None", "Open Angle Glaucoma")) +
ggtitle("Barbados Eye Study") +
ylab("VSQOL") +
annotate("text", x = 1, y = 93, label = "p < 0.05", size = 3) +
theme(
plot.title = element_text(size = 20),
legend.position = c(0.65, 1.07),
legend.text = element_text(size = 10),
legend.direction = "horizontal",
legend.title = element_blank(),
legend.key.size = unit(0.7, "lines"),
axis.title.x = element_blank(),
axis.text.x = element_text(angle = 40, hjust = 1, size = 10)
)
}
p_bes_vsqol_oag <- data_bes %>% plot_bes()
p_bes_vsqol_oag
dev.copy(png, "bes_vsqol.png", width = 2400, height = 1200, res = 300)
p_bes_vsqol_oag
dev.off()
# import data
data_bes_raw <- read_xlsx("Barbados Eye Study.xlsx", sheet = "Data")
# format data
data_bes <- data_bes_raw %>%
# remove row indicating n
dplyr::filter(vsqol != "n") %>%
mutate(
# add a value for indicating significance
p_0.05 = p_0.05*95 + 5,
# make a mean difference column
mean_diff = none - oag,
# add a value for indicating clinically meaningful difference
clinic_diff = ifelse(mean_diff >=5, 100, NA),
# make a max diff value for CTT so it's at the top
mean_diff = ifelse(vsqol == "*Composite score", yes = 100, no = mean_diff)
) %>%
# make to long format
gather(key = disease, value = mean, -vsqol, -p_0.05, -none_se, -oag_se, -mean_diff, -clinic_diff)
plot_bes <- function(data){
data %>%
ggplot(aes(x = reorder(vsqol, -mean_diff), fill = disease)) +
# geom_point(aes(y = clinic_diff), shape = 19, color = "blue", size = 4, alpha = 0.2) +
geom_point(aes(y = p_0.05), shape = 8, color = "red", size = 1, alpha = 0.8) +
geom_bar(aes(y = mean), stat = "identity", position = "dodge") +
scale_fill_manual(values = c("none" = "#FFC726", "oag" = "#00267F"), labels = c("None", "Open Angle Glaucoma")) +
ggtitle("Barbados Eye Study") +
ylab("VSQOL") +
annotate("text", x = 14, y = 93, label = "p < 0.05", size = 3) +
theme(
plot.title = element_text(size = 20),
legend.position = c(0.65, 1.07),
legend.text = element_text(size = 10),
legend.direction = "horizontal",
legend.title = element_blank(),
legend.key.size = unit(0.7, "lines"),
axis.title.x = element_blank(),
axis.text.x = element_text(angle = 40, hjust = 1, size = 10)
)
}
p_bes_vsqol_oag <- data_bes %>% plot_bes()
p_bes_vsqol_oag
dev.copy(png, "bes_vsqol.png", width = 2400, height = 1200, res = 300)
p_bes_vsqol_oag
dev.off()
# import data
data_bes_raw <- read_xlsx("Barbados Eye Study.xlsx", sheet = "Data")
# format data
data_bes <- data_bes_raw %>%
# remove row indicating n
dplyr::filter(vsqol != "n") %>%
mutate(
# add a value for indicating significance
p_0.05 = p_0.05*95 + 5,
# make a mean difference column
mean_diff = none - oag,
# add a value for indicating clinically meaningful difference
clinic_diff = ifelse(mean_diff >=5, 100, NA),
# make a max diff value for CTT so it's at the top
mean_diff = ifelse(vsqol == "*Composite score", yes = 100, no = mean_diff)
) %>%
# make to long format
gather(key = disease, value = mean, -vsqol, -p_0.05, -none_se, -oag_se, -mean_diff, -clinic_diff)
plot_bes <- function(data){
data %>%
ggplot(aes(x = reorder(vsqol, -mean_diff), fill = disease)) +
# geom_point(aes(y = clinic_diff), shape = 19, color = "blue", size = 4, alpha = 0.2) +
geom_point(aes(y = p_0.05), shape = 8, color = "red", size = 1, alpha = 0.8) +
geom_bar(aes(y = mean), stat = "identity", position = "dodge") +
scale_fill_manual(values = c("none" = "#FFC726", "oag" = "#00267F"), labels = c("None", "Open Angle Glaucoma")) +
ggtitle("Barbados Eye Study") +
ylab("VSQOL") +
annotate("text", x = 13, y = 93, label = "p < 0.05", size = 3) +
theme(
plot.title = element_text(size = 20),
legend.position = c(0.65, 1.07),
legend.text = element_text(size = 10),
legend.direction = "horizontal",
legend.title = element_blank(),
legend.key.size = unit(0.7, "lines"),
axis.title.x = element_blank(),
axis.text.x = element_text(angle = 40, hjust = 1, size = 10)
)
}
p_bes_vsqol_oag <- data_bes %>% plot_bes()
p_bes_vsqol_oag
dev.copy(png, "bes_vsqol.png", width = 2400, height = 1200, res = 300)
p_bes_vsqol_oag
dev.off()
# import data
data_bes_raw <- read_xlsx("Barbados Eye Study.xlsx", sheet = "Data")
# format data
data_bes <- data_bes_raw %>%
# remove row indicating n
dplyr::filter(vsqol != "n") %>%
mutate(
# add a value for indicating significance
p_0.05 = p_0.05*95 + 5,
# make a mean difference column
mean_diff = none - oag,
# add a value for indicating clinically meaningful difference
clinic_diff = ifelse(mean_diff >=5, 100, NA),
# make a max diff value for CTT so it's at the top
mean_diff = ifelse(vsqol == "*Composite score", yes = 100, no = mean_diff)
) %>%
# make to long format
gather(key = disease, value = mean, -vsqol, -p_0.05, -none_se, -oag_se, -mean_diff, -clinic_diff)
plot_bes <- function(data){
data %>%
ggplot(aes(x = reorder(vsqol, -mean_diff), fill = disease)) +
# geom_point(aes(y = clinic_diff), shape = 19, color = "blue", size = 4, alpha = 0.2) +
geom_point(aes(y = p_0.05), shape = 8, color = "red", size = 1, alpha = 0.8) +
geom_bar(aes(y = mean), stat = "identity", position = "dodge") +
scale_fill_manual(values = c("none" = "#FFC726", "oag" = "#00267F"), labels = c("None", "Open Angle Glaucoma")) +
ggtitle("Barbados Eye Study") +
ylab("VSQOL") +
annotate("text", x = 13, y = 100, label = "p < 0.05", size = 3) +
theme(
plot.title = element_text(size = 20),
legend.position = c(0.65, 1.07),
legend.text = element_text(size = 10),
legend.direction = "horizontal",
legend.title = element_blank(),
legend.key.size = unit(0.7, "lines"),
axis.title.x = element_blank(),
axis.text.x = element_text(angle = 40, hjust = 1, size = 10)
)
}
p_bes_vsqol_oag <- data_bes %>% plot_bes()
p_bes_vsqol_oag
dev.copy(png, "bes_vsqol.png", width = 2400, height = 1200, res = 300)
p_bes_vsqol_oag
dev.off()
# import data
data_bes_raw <- read_xlsx("Barbados Eye Study.xlsx", sheet = "Data")
# format data
data_bes <- data_bes_raw %>%
# remove row indicating n
dplyr::filter(vsqol != "n") %>%
mutate(
# add a value for indicating significance
p_0.05 = p_0.05*95 + 5,
# make a mean difference column
mean_diff = none - oag,
# add a value for indicating clinically meaningful difference
clinic_diff = ifelse(mean_diff >=5, 100, NA),
# make a max diff value for CTT so it's at the top
mean_diff = ifelse(vsqol == "*Composite score", yes = 100, no = mean_diff)
) %>%
# make to long format
gather(key = disease, value = mean, -vsqol, -p_0.05, -none_se, -oag_se, -mean_diff, -clinic_diff)
plot_bes <- function(data){
data %>%
ggplot(aes(x = reorder(vsqol, -mean_diff), fill = disease)) +
# geom_point(aes(y = clinic_diff), shape = 19, color = "blue", size = 4, alpha = 0.2) +
geom_point(aes(y = p_0.05), shape = 8, color = "red", size = 1, alpha = 0.8) +
geom_bar(aes(y = mean), stat = "identity", position = "dodge") +
scale_fill_manual(values = c("none" = "#FFC726", "oag" = "#00267F"), labels = c("None", "Open Angle Glaucoma")) +
ggtitle("Barbados Eye Study") +
ylab("VSQOL") +
annotate("text", x = 13, y = 100, label = "p < 0.05", size = 3) +
theme(
plot.title = element_text(size = 20),
legend.position = c(0.65, 1.0),
legend.text = element_text(size = 10),
legend.direction = "horizontal",
legend.title = element_blank(),
legend.key.size = unit(0.7, "lines"),
axis.title.x = element_blank(),
axis.text.x = element_text(angle = 40, hjust = 1, size = 10)
)
}
p_bes_vsqol_oag <- data_bes %>% plot_bes()
p_bes_vsqol_oag
dev.copy(png, "bes_vsqol.png", width = 2400, height = 1200, res = 300)
p_bes_vsqol_oag
dev.off()
# import data
data_bes_raw <- read_xlsx("Barbados Eye Study.xlsx", sheet = "Data")
# format data
data_bes <- data_bes_raw %>%
# remove row indicating n
dplyr::filter(vsqol != "n") %>%
mutate(
# add a value for indicating significance
p_0.05 = p_0.05*95 + 5,
# make a mean difference column
mean_diff = none - oag,
# add a value for indicating clinically meaningful difference
clinic_diff = ifelse(mean_diff >=5, 100, NA),
# make a max diff value for CTT so it's at the top
mean_diff = ifelse(vsqol == "*Composite score", yes = 100, no = mean_diff)
) %>%
# make to long format
gather(key = disease, value = mean, -vsqol, -p_0.05, -none_se, -oag_se, -mean_diff, -clinic_diff)
plot_bes <- function(data){
data %>%
ggplot(aes(x = reorder(vsqol, -mean_diff), fill = disease)) +
# geom_point(aes(y = clinic_diff), shape = 19, color = "blue", size = 4, alpha = 0.2) +
geom_point(aes(y = p_0.05), shape = 8, color = "red", size = 1, alpha = 0.8) +
geom_bar(aes(y = mean), stat = "identity", position = "dodge") +
scale_fill_manual(values = c("none" = "#FFC726", "oag" = "#00267F"), labels = c("None", "Open Angle Glaucoma")) +
ggtitle("Barbados Eye Study") +
ylab("VSQOL") +
annotate("text", x = 13, y = 100, label = "p < 0.05", size = 3) +
theme(
plot.title = element_text(size = 20),
legend.position = c(0.65, 1.05),
legend.text = element_text(size = 10),
legend.direction = "horizontal",
legend.title = element_blank(),
legend.key.size = unit(0.7, "lines"),
axis.title.x = element_blank(),
axis.text.x = element_text(angle = 40, hjust = 1, size = 10)
)
}
p_bes_vsqol_oag <- data_bes %>% plot_bes()
p_bes_vsqol_oag
dev.copy(png, "bes_vsqol.png", width = 2400, height = 1200, res = 300)
p_bes_vsqol_oag
dev.off()
# import data
data_bes_raw <- read_xlsx("Barbados Eye Study.xlsx", sheet = "Data")
# format data
data_bes <- data_bes_raw %>%
# remove row indicating n
dplyr::filter(vsqol != "n") %>%
mutate(
# add a value for indicating significance
p_0.05 = p_0.05*95 + 5,
# make a mean difference column
mean_diff = none - oag,
# add a value for indicating clinically meaningful difference
clinic_diff = ifelse(mean_diff >=5, 100, NA),
# make a max diff value for CTT so it's at the top
mean_diff = ifelse(vsqol == "*Composite score", yes = 100, no = mean_diff)
) %>%
# make to long format
gather(key = disease, value = mean, -vsqol, -p_0.05, -none_se, -oag_se, -mean_diff, -clinic_diff)
plot_bes <- function(data){
data %>%
ggplot(aes(x = reorder(vsqol, -mean_diff), fill = disease)) +
# geom_point(aes(y = clinic_diff), shape = 19, color = "blue", size = 4, alpha = 0.2) +
geom_point(aes(y = p_0.05), shape = 8, color = "red", size = 1, alpha = 0.8) +
geom_bar(aes(y = mean), stat = "identity", position = "dodge") +
scale_fill_manual(values = c("none" = "#FFC726", "oag" = "#00267F"), labels = c("None", "Open Angle Glaucoma")) +
ggtitle("Barbados Eye Study") +
ylab("VSQOL") +
annotate("text", x = 13, y = 100, label = "p < 0.05", size = 3) +
theme(
plot.title = element_text(size = 20),
legend.position = c(0.65, 1.03),
legend.text = element_text(size = 10),
legend.direction = "horizontal",
legend.title = element_blank(),
legend.key.size = unit(0.7, "lines"),
axis.title.x = element_blank(),
axis.text.x = element_text(angle = 40, hjust = 1, size = 10)
)
}
p_bes_vsqol_oag <- data_bes %>% plot_bes()
p_bes_vsqol_oag
dev.copy(png, "bes_vsqol.png", width = 2400, height = 1200, res = 300)
p_bes_vsqol_oag
dev.off()
# import data
data_bes_raw <- read_xlsx("Barbados Eye Study.xlsx", sheet = "Data")
# format data
data_bes <- data_bes_raw %>%
# remove row indicating n
dplyr::filter(vsqol != "n") %>%
mutate(
# add a value for indicating significance
p_0.05 = p_0.05*95 + 5,
# make a mean difference column
mean_diff = none - oag,
# add a value for indicating clinically meaningful difference
clinic_diff = ifelse(mean_diff >=5, 100, NA),
# make a max diff value for CTT so it's at the top
mean_diff = ifelse(vsqol == "*Composite score", yes = 100, no = mean_diff)
) %>%
# make to long format
gather(key = disease, value = mean, -vsqol, -p_0.05, -none_se, -oag_se, -mean_diff, -clinic_diff)
plot_bes <- function(data){
data %>%
ggplot(aes(x = reorder(vsqol, -mean_diff), fill = disease)) +
# geom_point(aes(y = clinic_diff), shape = 19, color = "blue", size = 4, alpha = 0.2) +
geom_point(aes(y = p_0.05), shape = 8, color = "red", size = 1, alpha = 0.8) +
geom_bar(aes(y = mean), stat = "identity", position = "dodge") +
scale_fill_manual(values = c("none" = "#FFC726", "oag" = "#00267F"), labels = c("None", "Open Angle Glaucoma")) +
ggtitle("Barbados Eye Study") +
ylab("VSQOL Score") +
xlab("NEI-VFQ-25 Subscale") +
annotate("text", x = 13, y = 100, label = "p < 0.05", size = 3) +
theme(
plot.title = element_text(size = 20),
legend.position = c(0.65, 1.03),
legend.text = element_text(size = 10),
legend.direction = "horizontal",
legend.title = element_blank(),
legend.key.size = unit(0.7, "lines"),
# axis.title.x = element_blank(),
axis.text.x = element_text(angle = 40, hjust = 1, size = 10)
)
}
p_bes_vsqol_oag <- data_bes %>% plot_bes()
p_bes_vsqol_oag
dev.copy(png, "bes_vsqol.png", width = 2400, height = 1200, res = 300)
p_bes_vsqol_oag
dev.off()
knitr::opts_chunk$set(echo = FALSE)
library(tidyverse)
library(readxl)
library(haven)
library(cowplot)
theme_set(theme_cowplot())
library(gridExtra)
library(grid)
path.afeds <- "/Volumes/GoogleDrive/My Drive/2017-2020 USC Roski Eye Institute/Population-Based Cohorts/AFEDS HRQOL VFL/AFEDS Data"
path.lales <- "/Volumes/GoogleDrive/My Drive/2017-2020 USC Roski Eye Institute/Population-Based Cohorts/!Original Data/lales data/datasets/1"
lales1_full <- read_sas(paste0(path.lales,"/hq1.sas7bdat"))
lales1 <- lales1_full %>% select(CaseID, I1, I1_Spec) %>%
mutate(origin_country = factor(I1, levels = c(1:7), labels = c("United States", "Mexico", "Other", "El Salvador", "Guatemala", "Nicaragua", "Other")))
lales <- read_xlsx(path = "CountryOrigin.xlsx", sheet = "LALES")
ches <- read_xlsx(path = "CountryOrigin.xlsx", sheet = "CHES")
afeds_full <- read_sas(data_file = paste0(path.afeds,"/afeds_datawrangling.sas7bdat"))
# glimpse(afeds_full)
afeds <- afeds_full %>% select(intid, H01, H01_spec) %>%
mutate(origin_country = factor(H01, levels = c(1, 2), labels = c("United States", "Other")))
# function for title and axes specs
form_title <- function(){theme(plot.title = element_text(vjust = 0, hjust = 0.5, size = 9),
axis.text.x = element_text(vjust = 0.99, hjust = 1, size = 6, angle = 40),
axis.text.y = element_text(size = 6))
}
# set common theme color
bar_colors <- function(){
scale_fill_manual(values=c("#990000", "#FFCC00"))
}
# afeds
p_afeds <- afeds %>%
group_by(origin_country) %>%
summarise(
n = n()
) %>%
ggplot(aes(x = fct_reorder(origin_country, -n), weight = n, fill = ifelse(origin_country == "United States", "blue", "gray"))) +
geom_bar() +
theme(legend.position = "none") +
# coord_flip() +
xlab("") +
ylab("") +
ylim(c(0, 6000)) +
ggtitle(paste0("AFEDS (n = ", afeds %>% nrow() %>% prettyNum(big.mark = ","), ")")) +
form_title() +
bar_colors()
# ches
p_ches <- ches %>%
ggplot(aes(x = fct_reorder(origin_country, -n), weight = n, fill = ifelse(origin_country == "United States", "blue", "gray"))) +
geom_bar() +
theme(legend.position = "none") +
# coord_flip() +
ylim(c(0, 6000)) +
xlab("") +
ylab("") +
ggtitle(paste0("CHES (n =", ches %>% summarise(sum(n)) %>% prettyNum(big.mark = ","), ")")) +
form_title() +
bar_colors()
# lales from actual data
p_lales1 <- lales1 %>%
group_by(origin_country) %>%
summarise(
n = n()
) %>%
ggplot(aes(x = fct_reorder(fct_explicit_na(origin_country), -n), weight = n, fill = ifelse(origin_country == "United States", "blue", "gray"))) +
geom_bar() +
theme(legend.position = "none") +
# coord_flip() +
xlab("") +
ylab("") +
ylim(c(0, 6000)) +
ggtitle(paste0("LALES (n = ", lales1 %>% nrow() %>% prettyNum(big.mark = ","), ")")) +
form_title() +
bar_colors()
# # lales
# p_lales <- lales %>%
#   ggplot(aes(x = fct_reorder(origin_country, -n), weight = n, fill = ifelse(origin_country == "United States", "blue", "gray"))) +
#   geom_bar() +
#   theme(legend.position = "none") +
#   # coord_flip() +
#   ylim(c(0, 6000)) +
#   xlab("") +
#   ylab("") +
#   ggtitle(paste0("LALES (n =", lales %>% summarise(sum(n)) %>% prettyNum(big.mark = ","), ")")) +
#   form_title() +
# bar_colors()
# make a grid of the three plots together
cohort_country <- grid.arrange(nrow = 1,  left = textGrob("Participants", vjust = 2, rot = 90, gp = gpar(cex = .8) ),
p_afeds, p_ches, p_lales1
)
par(bg=NA)
dev.copy(png, "!countryorigin.png", width = 1600, height = 600, res = 300)
cohort_country
dev.off()
afeds %>%
group_by(origin_country) %>%
summarise(
n = n()
) %>% glimpse
afeds %>%
group_by(origin_country) %>%
summarise(
n = n()
) %>% glimpse
